<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ship Navigation Dashboard</title>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        #map { height: 60vh; margin-top: 10px; }
        #alerts { margin: 10px 0; font-size: 18px; }
        #progress { font-size: 18px; margin: 10px 0; }
    </style>
</head>
<body>

<h2>Ship Navigation Dashboard</h2>

<div id="alerts"><strong>Alert: </strong><span id="alertMessage">Loading alerts...</span></div>
<div id="progress"><strong>Progress: </strong><span id="progressValue">0%</span></div>

<div id="map"></div>

<script>
    const map = L.map('map').setView([19.0760, 72.8777], 5);  // Initial view over Mumbai
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let routeLine = L.polyline([], {color: 'blue'}).addTo(map);
    let shipMarker = L.marker([19.0760, 72.8777]).addTo(map);

    async function fetchDashboardData() {
        const response = await fetch('/dashboard_data');
        const data = await response.json();

        if (data.error) {
            alert(data.error);
            return;
        }

        // Draw planned route once
        if (routeLine.getLatLngs().length === 0) {
            routeLine.setLatLngs(data.route);
            map.fitBounds(routeLine.getBounds());
        }

        // Update ship position
        if (data.current_location) {
            shipMarker.setLatLng(data.current_location);
        }

        // Update progress and alerts
        document.getElementById('progressValue').innerText = `${data.progress}%`;
        document.getElementById('alertMessage').innerText = data.alert;
    }

    setInterval(fetchDashboardData, 5000);  // Fetch new data every 5 seconds
    fetchDashboardData();  // Initial load
</script>

</body>
</html>
